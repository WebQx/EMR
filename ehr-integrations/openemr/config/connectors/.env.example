# OpenEMR Connector Configuration Example
# Copy this file to .env and configure with your actual values

# ===================================
# Central Identity Provider (IDP) Configuration
# ===================================

# The issuer URL of your central IDP (e.g., Keycloak, Auth0, Azure AD)
CENTRAL_IDP_ISSUER=https://auth.webqx.health

# OAuth2 client credentials for your application registered with the central IDP
CENTRAL_IDP_CLIENT_ID=webqx-openemr-connector
CENTRAL_IDP_CLIENT_SECRET=your-central-idp-client-secret

# The redirect URI where the IDP will send authorization codes
CENTRAL_IDP_REDIRECT_URI=https://your-app.webqx.health/auth/callback

# OpenID Connect discovery URL (optional - will be constructed from issuer if not provided)
CENTRAL_IDP_DISCOVERY_URL=https://auth.webqx.health/.well-known/openid_configuration

# ===================================
# OpenEMR Configuration
# ===================================

# Base URL of your OpenEMR installation
OPENEMR_BASE_URL=https://openemr.your-organization.com

# OAuth2 client credentials for accessing OpenEMR APIs
OPENEMR_CLIENT_ID=webqx-connector
OPENEMR_CLIENT_SECRET=your-openemr-client-secret

# OpenEMR API version
OPENEMR_API_VERSION=7.0.2

# ===================================
# API Gateway Configuration
# ===================================

# Port and host for the API Gateway server
API_GATEWAY_PORT=3001
API_GATEWAY_HOST=0.0.0.0

# Base path for OpenEMR API endpoints
API_GATEWAY_BASE_PATH=/api/v1/openemr

# CORS configuration
ENABLE_CORS=true
CORS_ORIGINS=https://your-frontend.webqx.health,https://admin.webqx.health

# ===================================
# Security Configuration
# ===================================

# Enable PKCE (Proof Key for Code Exchange) for enhanced OAuth2 security
ENABLE_PKCE=true

# Token validation settings
VALIDATE_ISSUER=true
VALIDATE_AUDIENCE=true
CLOCK_SKEW_TOLERANCE=300

# Security headers
ENABLE_SECURITY_HEADERS=true
ENABLE_CSRF_PROTECTION=true

# Request validation
ENABLE_REQUEST_VALIDATION=true
MAX_REQUEST_SIZE=10485760

# ===================================
# Rate Limiting Configuration
# ===================================

# Enable rate limiting to prevent abuse
RATE_LIMIT_ENABLED=true

# Rate limiting window (15 minutes = 900000ms)
RATE_LIMIT_WINDOW_MS=900000

# Maximum requests per window
RATE_LIMIT_MAX_REQUESTS=100

# Skip rate limiting for successful requests
RATE_LIMIT_SKIP_SUCCESSFUL=true

# ===================================
# Circuit Breaker Configuration
# ===================================

# Enable circuit breaker to handle service failures gracefully
CIRCUIT_BREAKER_ENABLED=true

# Number of failures before opening the circuit
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5

# Time to wait before attempting to close the circuit (1 minute = 60000ms)
CIRCUIT_BREAKER_RECOVERY_TIME_MS=60000

# Monitoring window for failure tracking (5 minutes = 300000ms)
CIRCUIT_BREAKER_MONITORING_WINDOW_MS=300000

# ===================================
# Token Management Configuration
# ===================================

# Token cache settings
CACHE_TOKENS=true
TOKEN_CACHE_TTL_SECONDS=300

# Token refresh settings
ENABLE_TOKEN_REFRESH=true
TOKEN_REFRESH_THRESHOLD_SECONDS=300

# Token TTL settings
ACCESS_TOKEN_TTL=3600
REFRESH_TOKEN_TTL=604800

# ===================================
# Session Management Configuration
# ===================================

# Enable session management
ENABLE_SESSION_MANAGEMENT=true

# Session timeout (1 hour = 3600 seconds)
SESSION_TIMEOUT_SECONDS=3600

# Concurrent sessions
ENABLE_CONCURRENT_SESSIONS=true
MAX_CONCURRENT_SESSIONS=5

# ===================================
# Access Control Configuration
# ===================================

# Enable Role-Based Access Control
ENABLE_RBAC=true

# Enable resource-level access control
ENABLE_RESOURCE_LEVEL_ACCESS=true

# Enable patient context isolation
ENABLE_PATIENT_CONTEXT=true

# Enable provider context isolation
ENABLE_PROVIDER_CONTEXT=true

# ===================================
# Audit and Logging Configuration
# ===================================

# Enable comprehensive audit logging
AUDIT_ENABLED=true

# Log all requests (disable in production for performance)
LOG_ALL_REQUESTS=false

# Log authentication failures
LOG_FAILED_AUTH=true

# Log permission denied events
LOG_PERMISSION_DENIED=true

# Log token exchange events
LOG_TOKEN_EXCHANGE=true

# Log user mapping events
LOG_USER_MAPPING=false

# Log request/response details
LOG_REQUESTS=true
LOG_RESPONSES=false
LOG_HEADERS=false

# ===================================
# Network and Timeout Configuration
# ===================================

# Request timeout for OpenEMR API calls (30 seconds = 30000ms)
REQUEST_TIMEOUT_MS=30000

# Retry configuration
RETRY_ATTEMPTS=3
RETRY_DELAY_MS=1000

# ===================================
# Development/Debug Configuration
# ===================================

# Environment (development, staging, production)
NODE_ENV=development

# Enable debug logging (use sparingly in production)
DEBUG=openemr:*

# Enable additional validation in development
ENABLE_ADDITIONAL_VALIDATION=true

# ===================================
# Health Check Configuration
# ===================================

# Enable health check endpoints
ENABLE_HEALTH_CHECKS=true

# Health check interval (for internal monitoring)
HEALTH_CHECK_INTERVAL_MS=60000

# ===================================
# Performance Configuration
# ===================================

# Maximum concurrent operations
MAX_CONCURRENT_OPERATIONS=10

# Connection pool settings (if using database)
DB_POOL_MIN=5
DB_POOL_MAX=20

# ===================================
# Example Production Overrides
# ===================================

# Uncomment and modify these for production deployments:

# Higher rate limits for production
# RATE_LIMIT_MAX_REQUESTS=1000
# RATE_LIMIT_WINDOW_MS=3600000

# Stricter security in production
# VALIDATE_ISSUER=true
# VALIDATE_AUDIENCE=true
# ENABLE_CSRF_PROTECTION=true

# Reduced logging in production
# LOG_ALL_REQUESTS=false
# LOG_RESPONSES=false
# DEBUG=

# Production session settings
# SESSION_TIMEOUT_SECONDS=1800
# MAX_CONCURRENT_SESSIONS=3

# ===================================
# Notes
# ===================================

# 1. Replace all placeholder values with your actual configuration
# 2. Store sensitive values (secrets, passwords) securely
# 3. Use environment-specific configurations for different deployments
# 4. Test all configurations in a development environment first
# 5. Monitor health check endpoints in production
# 6. Review audit logs regularly for security monitoring