<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebQX GitHub Pages Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            background: #f8f9fa;
        }

        .header {
            background: linear-gradient(135deg, #0891b2 0%, #164e63 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .integration-test {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }

        .test-section h3 {
            color: #1f2937;
            margin-top: 0;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online { background-color: #10b981; }
        .status-offline { background-color: #ef4444; }
        .status-loading { background-color: #f59e0b; }

        button {
            background: #0891b2;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem 0.5rem 0.5rem 0;
            font-size: 1rem;
            transition: background 0.2s;
        }

        button:hover {
            background: #164e63;
        }

        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .response-box {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .success { border-left: 4px solid #10b981; }
        .error { border-left: 4px solid #ef4444; }
        .warning { border-left: 4px solid #f59e0b; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-card {
            background: #f0f9ff;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #0891b2;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #0891b2;
        }

        .stat-label {
            color: #374151;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üè• WebQX GitHub Pages Integration Test</h1>
        <p>Testing integration between GitHub Pages and local WebQX EMR system</p>
        <div id="main-status">
            <span class="status-indicator status-loading" id="main-indicator"></span>
            <span id="main-status-text">Initializing...</span>
        </div>
    </div>

    <div class="integration-test">
        <h2>üîó Integration Status</h2>
        
        <div class="test-section">
            <h3>1. Remote Trigger API (Port 8080)</h3>
            <p>Tests the GitHub Pages to local server communication</p>
            <button onclick="testRemoteAPI()">Test Remote API</button>
            <div id="remote-api-response" class="response-box" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>2. WebQX EMR API (Port 8085)</h3>
            <p>Tests the local EMR system status and features</p>
            <button onclick="testEMRAPI()">Test EMR API</button>
            <button onclick="testEMRHealth()">Test EMR Health</button>
            <div id="emr-api-response" class="response-box" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>3. Community Health Stats</h3>
            <p>Tests the community health tracking integration</p>
            <button onclick="testCommunityStats()">Get Community Stats</button>
            <div id="community-stats-response" class="response-box" style="display: none;"></div>
            <div id="community-stats-display" class="stats-grid" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>4. Cross-Origin Integration</h3>
            <p>Tests CORS configuration for GitHub Pages</p>
            <button onclick="testCORS()">Test CORS</button>
            <div id="cors-response" class="response-box" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>5. End-to-End Integration</h3>
            <p>Tests complete GitHub Pages ‚Üí Remote API ‚Üí EMR flow</p>
            <button onclick="testFullIntegration()">Test Full Integration</button>
            <div id="full-integration-response" class="response-box" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Integration test functions
        async function testRemoteAPI() {
            const responseEl = document.getElementById('remote-api-response');
            responseEl.style.display = 'block';
            responseEl.textContent = 'Testing remote API...';
            responseEl.className = 'response-box';

            try {
                const response = await fetch('http://localhost:8080/health');
                const data = await response.json();
                
                responseEl.textContent = JSON.stringify(data, null, 2);
                responseEl.className = 'response-box success';
                
                updateMainStatus('online', 'Remote API: Online ‚úì');
            } catch (error) {
                responseEl.textContent = `Error: ${error.message}`;
                responseEl.className = 'response-box error';
                updateMainStatus('offline', 'Remote API: Offline ‚úó');
            }
        }

        async function testEMRAPI() {
            const responseEl = document.getElementById('emr-api-response');
            responseEl.style.display = 'block';
            responseEl.textContent = 'Testing EMR API...';
            responseEl.className = 'response-box';

            try {
                const response = await fetch('http://localhost:8085/webqx-api.php?action=status');
                const data = await response.json();
                
                responseEl.textContent = JSON.stringify(data, null, 2);
                responseEl.className = 'response-box success';
            } catch (error) {
                responseEl.textContent = `Error: ${error.message}`;
                responseEl.className = 'response-box error';
            }
        }

        async function testEMRHealth() {
            const responseEl = document.getElementById('emr-api-response');
            responseEl.style.display = 'block';
            responseEl.textContent = 'Testing EMR health...';
            responseEl.className = 'response-box';

            try {
                const response = await fetch('http://localhost:8085/webqx-api.php?action=health');
                const data = await response.json();
                
                responseEl.textContent = JSON.stringify(data, null, 2);
                responseEl.className = 'response-box success';
            } catch (error) {
                responseEl.textContent = `Error: ${error.message}`;
                responseEl.className = 'response-box error';
            }
        }

        async function testCommunityStats() {
            const responseEl = document.getElementById('community-stats-response');
            const displayEl = document.getElementById('community-stats-display');
            
            responseEl.style.display = 'block';
            responseEl.textContent = 'Getting community stats...';
            responseEl.className = 'response-box';

            try {
                const response = await fetch('http://localhost:8080/api/community-stats');
                const data = await response.json();
                
                responseEl.textContent = JSON.stringify(data, null, 2);
                responseEl.className = 'response-box success';

                if (data.status === 'success' && data.community_stats) {
                    const stats = data.community_stats;
                    displayEl.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-number">${stats.underserved_patients}</div>
                            <div class="stat-label">Underserved Patients</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.free_services_provided}</div>
                            <div class="stat-label">Free Services</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.mobile_clinic_visits}</div>
                            <div class="stat-label">Mobile Clinic Visits</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.telemedicine_consults}</div>
                            <div class="stat-label">Telemedicine Consults</div>
                        </div>
                    `;
                    displayEl.style.display = 'grid';
                }
            } catch (error) {
                responseEl.textContent = `Error: ${error.message}`;
                responseEl.className = 'response-box error';
            }
        }

        async function testCORS() {
            const responseEl = document.getElementById('cors-response');
            responseEl.style.display = 'block';
            responseEl.textContent = 'Testing CORS configuration...';
            responseEl.className = 'response-box';

            try {
                const response = await fetch('http://localhost:8080/api/server-status', {
                    method: 'GET',
                    headers: {
                        'Origin': 'https://webqx.github.io',
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                const corsHeaders = {
                    'access-control-allow-origin': response.headers.get('access-control-allow-origin'),
                    'access-control-allow-methods': response.headers.get('access-control-allow-methods'),
                    'access-control-allow-headers': response.headers.get('access-control-allow-headers')
                };
                
                responseEl.textContent = `CORS Headers:\n${JSON.stringify(corsHeaders, null, 2)}\n\nResponse:\n${JSON.stringify(data, null, 2)}`;
                responseEl.className = 'response-box success';
            } catch (error) {
                responseEl.textContent = `CORS Error: ${error.message}`;
                responseEl.className = 'response-box error';
            }
        }

        async function testFullIntegration() {
            const responseEl = document.getElementById('full-integration-response');
            responseEl.style.display = 'block';
            responseEl.textContent = 'Testing full integration chain...';
            responseEl.className = 'response-box';

            const results = {};

            try {
                // Step 1: Test Remote API
                responseEl.textContent += '\n\n1. Testing Remote API...';
                const remoteResponse = await fetch('http://localhost:8080/health');
                results.remote_api = await remoteResponse.json();

                // Step 2: Test EMR through Remote API
                responseEl.textContent += '\n2. Testing EMR through Remote API...';
                const emrResponse = await fetch('http://localhost:8080/api/server-status');
                results.emr_via_remote = await emrResponse.json();

                // Step 3: Test Direct EMR
                responseEl.textContent += '\n3. Testing Direct EMR...';
                const directResponse = await fetch('http://localhost:8085/webqx-api.php?action=status');
                results.direct_emr = await directResponse.json();

                // Step 4: Test Community Stats
                responseEl.textContent += '\n4. Testing Community Stats...';
                const statsResponse = await fetch('http://localhost:8080/api/community-stats');
                results.community_stats = await statsResponse.json();

                responseEl.textContent = 'Full Integration Test Results:\n\n' + JSON.stringify(results, null, 2);
                responseEl.className = 'response-box success';

                updateMainStatus('online', 'Full Integration: Working ‚úì');
            } catch (error) {
                responseEl.textContent += `\n\nError: ${error.message}`;
                responseEl.className = 'response-box error';
                updateMainStatus('offline', 'Integration: Failed ‚úó');
            }
        }

        function updateMainStatus(status, text) {
            const indicator = document.getElementById('main-indicator');
            const statusText = document.getElementById('main-status-text');
            
            indicator.className = `status-indicator status-${status}`;
            statusText.textContent = text;
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                testRemoteAPI();
            }, 1000);
        });
    </script>
</body>
</html>